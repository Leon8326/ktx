#!/data/data/com.termux/files/usr/bin/bash

# This script sets up the environment to run SDDM inside Debian, starts the Termux X11 server, and opens the X11 app.

echo "Setting up environment for SDDM inside Debian, starting Termux X11 server, and launching the X11 app..."

# Step 1: Kill any running instances of Termux X11 server or PulseAudio
echo "Killing any running instances of termux-x11 and pulseaudio..."
killall termux-x11
killall pulseaudio

# Step 2: Install dependencies in Termux (like proot, termux-x11, and pulseaudio)
pkg update -y
pkg upgrade -y
pkg install -y proot wget git termux-x11 pulseaudio

# Step 3: Start Termux X11 server in the background
echo "Starting Termux X11 server..."
termux-x11 :0 &

# Step 4: Start PulseAudio in the background
echo "Starting PulseAudio..."
pulseaudio --start &

# Step 5: Open the Termux X11 app using the `am start` command
echo "Opening Termux X11 app..."
am start --user 0 -n com.termux.x11/com.termux.x11.MainActivity > /dev/null 2>&1

# Step 6: Ensure the Termux X11 app is running
echo "Make sure the Termux X11 app is running on your device. It should automatically launch."
sleep 2

# Step 7: Launch the Debian chroot environment and execute init_sddm inside it
echo "Starting Debian environment and executing init_sddm script..."
proot-distro login debian --init-env ./init_sddm

# End of script
